<div class="content full-width">
  <div [ngBusy]="busy"></div>
  <div class="widget map full-width" style="margin-top: -25px; overflow: hidden;">
    <app-google-map [property]="propertyService.property"
        [compmeta]="propertyService.propertyCompsMeta"
        [properties]="propertyService.propertyComps"
        [altProperties]="propertyService.propertyCompsBackground"
        [altToggle]="altPropertyToggle"
        [disableLabels]="true"
        [selected]="propertyService.propertyCompsSelectedList"
        [active]="isActive() && propertyService.propertyComps && (propertyService.propertyComps.length > 0)"
        [shrink]="mapShrink"
        (select)="togglePropertySummary($event)">
    </app-google-map>
    <div id="compalator-branding">COMPALATOR™</div>
    <app-property-slideout tabLocation="right" topPos="0px" rightPos="0px"
        [active]="isActive() && propertyService.getListPrice()" (toggle)="setMapShrink($event)">
      <a class="handle" href="javascript:void(0)"><span>Property Info</span></a>
      <div class="info">{{propertyService.getCurrentProperty().address?.line1}}<span>{{propertyService.getCurrentProperty().address?.line2}}</span></div>
      <div class="info">{{propertyService.getRepairConditionName(propertyService.getFlipRepairsCondition())}}<span>Condition</span></div>
      <div class="info">{{propertyService.getCurrentProperty().mls?.statusShortValue}}<span>Status</span></div>
      <div class="info">${{propertyService.getListPrice()}} <span>List Price</span></div>
      <br>
      <ol class="tags featured">
        <li><strong>{{propertyService.getCurrentProperty().building?.rooms?.beds}}</strong> Bed</li>
        <li><strong>{{propertyService.getCurrentProperty().building?.rooms?.bathsTotal}}</strong> Bath</li>
        <li><strong>{{propertyService.getGarageSpaces()}}</strong> Car</li>
        <li [ngClass]="{'dimmed': !propertyService.getCurrentProperty().lot?.poolInd || ('0' == propertyService.getCurrentProperty().lot?.poolInd), 'more-info': propertyService.getCurrentProperty().lot?.poolInd && ('0' != propertyService.getCurrentProperty().lot?.poolInd)}">
            <strong>Pool</strong>
            <div><p>{{propertyService.getCurrentProperty().lot?.poolType}}</p></div>
        </li>
        <li [ngClass]="{'dimmed': propertyService.getCurrentProperty().mls?.hoaType != 'Mandatory', 'more-info': propertyService.getCurrentProperty().mls?.hoaType != 'None' && propertyService.getCurrentProperty().mls?.hoaType != ''}">
            <strong>HOA</strong>
            <div>
              <p>{{propertyService.getCurrentProperty().mls?.hoaType}} Membership</p>
              <p>{{propertyService.getCurrentProperty().mls?.hoaPeriod}} Fee: {{propertyService.getCurrentProperty().mls?.hoaFee | currency:'USD':true:'1.0-2'}}</p>
            </div>
        </li>
        <li [ngClass]="{'more-info': propertyService.getCurrentProperty().building?.summary?.yearBuiltEffective}">
            Built in: <strong>{{propertyService.getCurrentProperty().summary?.yearBuilt}}</strong>
            <div><p>Effective Year Built: {{propertyService.getCurrentProperty().building?.summary?.yearBuiltEffective}}</p></div>
        </li>
        <li class="more-info">
          <strong>{{propertyService.getCurrentProperty().building?.size?.livingSize | number : '1.0-0'}}</strong> SQ FT <strong> Living</strong>
          <div>
            <p>TOT BLDG: <b>{{propertyService.getFootageSourceDescription()}}</b></p>
          </div>
        </li>
        <li class="more-info">
            <strong>{{propertyService.getCurrentProperty().lot?.lotSizeInSQFT | number : '1.0-0'}}</strong> SQ FT LOT
            <div><p>{{propertyService.getCurrentProperty().lot?.lotSizeInAcres | number : '1.0-4'}} acres</p></div>
        </li>
        <li class="more-info" *ngIf="propertyService.getCurrentProperty().summary?.propSubType">
            <strong>{{propertyService.getCurrentProperty().summary?.propLandUse}}</strong>
            <div>{{propertyService.getCurrentProperty().summary?.propSubType}}</div>
        </li>
      </ol>
      <br>
      <ol class="tags">
        <li class="clickable more-info" (click)="toggleCompsMapAlt()">
          Toggle Non-Comp Solds
          <div style="width: 215px">Toggle between displaying all the solds in this search, or only relevant comps.</div>
        </li>
      </ol>
    </app-property-slideout>
    <!--app-property-slideout tabLocation="right" topPos="200px" leftPos="0px"
        [active]="true" (toggle)="toggleCompsMapAlt($event)" *ngIf="type == 'arv'">
      <a class="handle" href="javascript:void(0)"><span>Show All Solds</span></a>
      <div>Hide All Solds</div>
    </app-property-slideout-->
    <!--app-property-slideout tabLocation="left" topPos="10px"
        leftPos="20px" [active]="isActive() && propertyService.getListPrice()"
        (toggle)="setMapShrink($event)">
        <a class="handle" href="javascript:void(0)"><span>Other Info</span></a>
        There Is Stuff In Here
    </app-property-slideout-->
  </div>
<!-- propertyCompsMeta.compsFilterUsed -->
  <div class="widget notice full-width" style="visibility: hidden" *ngIf="columnProperties">
    <h2 style="visibility: visible">
      <small class="rating-pill" style="border: 2px solid green"
          *ngIf="(page > 0 || generatedValue) && type == 'arv' && propertyService.propertyCompsMeta.analysisRatingTier >= 3">{{propertyService.propertyCompsMeta.analysisRating / 10}} / 10</small>
      <small class="rating-pill" style="border: 2px solid yellowgreen"
          *ngIf="(page > 0 || generatedValue) && type == 'arv' && propertyService.propertyCompsMeta.analysisRatingTier == 2">{{propertyService.propertyCompsMeta.analysisRating / 10}} / 10</small>
      <small class="rating-pill" style="border: 2px solid yellow"
          *ngIf="(page > 0 || generatedValue) && type == 'arv' && propertyService.propertyCompsMeta.analysisRatingTier == 1">{{propertyService.propertyCompsMeta.analysisRating / 10}} / 10</small>
      <small class="rating-pill" style="border: 2px solid orange"
          *ngIf="(page > 0 || generatedValue) && type == 'arv' && propertyService.propertyCompsMeta.analysisRatingTier == 0">{{propertyService.propertyCompsMeta.analysisRating / 10}} / 10</small>
      <div class="calctooltip" *ngIf="page > 0 || generatedValue">
        {{getCompLabel()}} ${{propertyService.getPropertyCompPrice()}}
        <span class="calctooltiptext">{{getCompTooltip()}}</span>
      </div>
      <br>
      <!--small style="margin-left: 0.6rem">{{getCompType()}}</small-->
      <br>
      <div style="color: #525252; display: inline-block; margin: 0 1%; font-size: 110%;">
        COMPALATOR™
      </div>
      <a class="clickable" style="font-weight: lighter; font-size: 70%; margin: 0 1%" (click)="nextPage()" *ngIf="page < getLastPage()">Page {{page + 2}}: {{pageNames[page + 1]}} &gt;</a>
      <a class="clickable" style="font-weight: lighter; font-size: 70%; margin: 0 1%" (click)="prevPage()" *ngIf="page > 0">&lt; Page {{page}}: {{pageNames[page - 1]}}</a>
    </h2>
  </div>
  <div class="widget notice full-width" style="margin-top: -30px"
      [ngStyle]="{'visibility': resultsShowMore ? 'visible' : 'hidden', 'margin-bottom': resultsShowMore ? '1.875rem' : '0px'}" *ngIf="propertyService.propertyCompsMeta?.compsFilterUsed?.resultsDetails && page < 1">
    <h2 style="visibility: visible">
      <small>Comps Results Breakdown</small>
      <br>
      <a class="clickable" style="font-weight: lighter; font-size: 70%" (click)="resultsShowMore = true" *ngIf="!resultsShowMore">Show more..</a>
      <a class="clickable" style="font-weight: lighter; font-size: 70%" (click)="resultsShowMore = false" *ngIf="resultsShowMore">Show less..</a>
    </h2>
    <div class="note comps-breakdown" style="width: 25%; display: inline-block; margin-right: 5%; vertical-align: top" *ngIf="resultsShowMore">
      <p>
        <small>Initial results</small><b>{{propertyService.propertyCompsMeta.compsFilterUsed.resultsDetails.total}}</b>
      </p>
      <hr>
      <p *ngIf="propertyService.propertyCompsMeta.compsFilterUsed.resultsDetails.date">
        <small>Excluded by sale date</small><b>{{propertyService.propertyCompsMeta.compsFilterUsed.resultsDetails.date}}</b>
      </p>
      <p *ngIf="propertyService.propertyCompsMeta.compsFilterUsed.resultsDetails.status">
        <small>Excluded by status</small><b>{{propertyService.propertyCompsMeta.compsFilterUsed.resultsDetails.status}}</b>
      </p>
      <p *ngIf="propertyService.propertyCompsMeta.compsFilterUsed.resultsDetails.subtype">
        <small>Excluded by property subtype</small><b>{{propertyService.propertyCompsMeta.compsFilterUsed.resultsDetails.subtype}}</b>
      </p>
      <p *ngIf="propertyService.propertyCompsMeta.compsFilterUsed.resultsDetails.year">
        <small>Excluded by year built</small><b>{{propertyService.propertyCompsMeta.compsFilterUsed.resultsDetails.year}}</b>
      </p>
      <p *ngIf="propertyService.propertyCompsMeta.compsFilterUsed.resultsDetails.gla">
        <small>Excluded by footage</small><b>{{propertyService.propertyCompsMeta.compsFilterUsed.resultsDetails.gla}}</b>
      </p>
      <p *ngIf="propertyService.propertyCompsMeta.compsFilterUsed.resultsDetails.pool && propertyService.propertyCompsMeta.compsFilterUsed.pool">
        <small>Excluded by pools</small><b>{{propertyService.propertyCompsMeta.compsFilterUsed.resultsDetails.pool}}</b>
      </p>
      <p *ngIf="propertyService.propertyCompsMeta.compsFilterUsed.resultsDetails.stories && propertyService.propertyCompsMeta.compsFilterUsed.stories">
        <small>Excluded by stories</small><b>{{propertyService.propertyCompsMeta.compsFilterUsed.resultsDetails.stories}}</b>
      </p>
      <hr>
      <p>
        <small>Suitable comps</small><b>{{propertyService.propertyCompsMeta.compsFilterUsed.resultsDetails.passed}}</b>
      </p>
    </div>
  </div>
  <div class="widget notice full-width" *ngIf="!propertySummary && page < 1">
    <h2>
      <small class="rating-pill" style="border: 2px solid green" *ngIf="!generatedValue && type == 'arv' && propertyService.propertyCompsMeta.analysisRatingTier >= 3">{{propertyService.propertyCompsMeta.analysisRating / 10}} / 10</small>
      <small class="rating-pill" style="border: 2px solid yellowgreen" *ngIf="!generatedValue && type == 'arv' && propertyService.propertyCompsMeta.analysisRatingTier == 2">{{propertyService.propertyCompsMeta.analysisRating / 10}} / 10</small>
      <small class="rating-pill" style="border: 2px solid yellow" *ngIf="!generatedValue && type == 'arv' && propertyService.propertyCompsMeta.analysisRatingTier == 1">{{propertyService.propertyCompsMeta.analysisRating / 10}} / 10</small>
      <small class="rating-pill" style="border: 2px solid orange" *ngIf="!generatedValue && type == 'arv' && propertyService.propertyCompsMeta.analysisRatingTier == 0">{{propertyService.propertyCompsMeta.analysisRating / 10}} / 10</small>
      <div class="calctooltip" *ngIf="!generatedValue && type">
        {{getCompLabel()}} ${{propertyService.getPropertyCompPrice()}}
        <span class="calctooltiptext" style="padding: 10px; font-weight: normal; font-size: 60%">{{getCompTooltip()}}</span>
      </div>
      <br>
      <!--small style="margin-left: 0.6rem">{{getCompType()}}</small-->
      <br>
      <a class="clickable" style="font-weight: lighter; font-size: 70%" (click)="narrShowMore = true" *ngIf="!narrShowMore">Show more..</a>
      <a class="clickable" style="font-weight: lighter; font-size: 70%" (click)="narrShowMore = false" *ngIf="narrShowMore">Show less..</a>
    </h2>
    <div class="note" [ngClass]="{'narr-show-more': narrShowMore, 'narr-show-less': !narrShowMore}" [innerHTML]="propertyService.describeCompProperties()"></div>
  </div>
  <div class="widget notice full-width" *ngIf="type == 'arv' && !propertySummary && page < 1">
    <h2>
      <div>Comps Filters<span style="color: #525252; font-size: 90%" *ngIf="generatedValue">:&nbsp;&nbsp;&nbsp;&nbsp;{{lastResults}} / {{compsUniverse.length}} Results</span>
          <span style="color: #525252; font-weight: lighter; font-size: 80%; float: right">{{loadDescription}}</span></div>
    </h2>
    <div class="note">
      <p>
        <span style="display: inline-block; width: 200px; height: 50px">Proximity to subject</span>
        <template ngFor let-miles [ngForOf]="filterProximity">
          <a class="clickable rating-pill option-pill" (click)="setFilterProximity(miles)" [ngClass]="{'selected': miles == compsFilter.proximityInMiles}">{{miles.toFixed(2)}} Mi</a>
        </template>
      </p>
      <p>
        <span style="display: inline-block; width: 200px; height: 50px">GLA relative to subject</span>
        <template ngFor let-percent [ngForOf]="filterGla">
          <a class="clickable rating-pill option-pill" (click)="setFilterGla(percent)" [ngClass]="{'selected': percent == compsFilter.sqftTotalWithIn}">&#177; {{percent}}%</a>
        </template>
      </p>
      <p>
        <span style="display: inline-block; width: 200px;">Sale date within past</span>
        <template ngFor let-days [ngForOf]="filterSale">
          <a class="clickable rating-pill option-pill" (click)="setFilterSale(days)" [ngClass]="{'selected': days == compsFilter.statusChangeInDays}">{{days}} Days</a>
        </template>
      </p>
      <p style="float: right; margin-top: -31px" *ngIf="generatedValue || customFiltersPresent">
        <a class="button secondary small clickable" (click)="resetArvRevision()">
          <span>Reset to Default</span>
        </a>
        <a style="margin-left: 1rem" class="button secondary small clickable" (click)="saveArvRevision()">
          <span>{{ saving ? 'Saving..' : 'Save to HIT' }}</span>
        </a>
      </p>
    </div>
  </div>
  <div class="widget table narrow full-width" *ngIf="page < 1">
    <table *ngIf="page < 1">
      <thead>
        <tr>
          <th>&nbsp;</th>
          <th class="left">Address</th>
          <th class="left" *ngIf="propertyService.propertyCompsMeta.hasRatings">Rating</th>
          <th>Dist</th>
          <th>Bed</th>
          <th>Bth</th>
          <th>GAR</th>
          <th>Year</th>
          <th>Pool</th>
          <th>SqFt</th>
          <th>Acres</th>
          <th>List</th>
          <!--<th>Sold Price</th>-->
          <!--<th>SP%LP</th>-->
          <th>$/Sqft</th>
          <th>CDOM</th>
          <th>Close Date</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngIf="propertySummary"
            [ngClass]="{selected: propertyService.isCompSelected(propertySummary)}">
            <td class="picture">
              <div class="image"><img src="{{propertyService.getFirstPhoto(propertyService.getCompProperty(propertySummary))}}"></div>
            </td>
            <td class="left"><a class="clickable" (click)="togglePropertySummary(propertySummary)"><b>{{propertyService.getCompProperty(propertySummary).address?.line1}}<br>{{propertyService.getPropertyData(property).address?.line2}}</b></a></td>
            <td class="left" *ngIf="propertyService.propertyCompsMeta.hasRatings">&nbsp;</td>
            <td class="left">{{propertyService.getCompPropertyDistance(propertySummary)}}</td>
            <td>{{propertyService.getCompProperty(propertySummary).building?.rooms?.beds}}</td>
            <td>{{propertyService.getCompProperty(propertySummary).building?.rooms?.bathsFull}}/{{propertyService.getCompProperty(propertySummary).building?.rooms?.bathsHalf}}</td>
            <td>{{propertyService.getGarageSpaces(propertyService.getCompProperty(propertySummary))}} / {{propertyService.getCompProperty(propertySummary).building?.parking?.prkgSpaces}}</td>
            <td>{{propertyService.getCompProperty(propertySummary).summary?.yearBuilt}}</td>
            <td>{{(propertyService.getCompProperty(propertySummary).lot?.poolInd && ('0' != propertyService.getCompProperty(propertySummary).lot?.poolInd)) ? 'Y' : 'N'}}</td>
            <td>{{propertyService.getCompProperty(propertySummary).building?.size?.livingSize || propertyService.getCompProperty(propertySummary).building?.size?.bldgSize}}</td>
            <td>{{propertyService.getCompProperty(propertySummary).lot?.lotSizeInAcres}}</td>
            <td>{{propertyService.getListPrice(propertyService.getCompProperty(propertySummary))}}</td>
            <!--<td>-</td>-->
            <!--<td>-</td>-->
            <td>
              <div class="calctooltip">
                ${{pricePerFootage(propertyService.getListPrice(propertyService.getCompProperty(propertySummary)), propertyService.getCompProperty(propertySummary).building?.size?.bldgSize) | number:'1.0-0'}}
                <span class="calctooltiptext" style="width: 100px">
                  ${{pricePerFootage(propertyService.getClosePrice(propertyService.getCompProperty(propertySummary)), propertyService.getCompProperty(propertySummary).building?.size?.bldgSize) | number:'1.0-0' }} / ft²
                  <br><br>
                  ${{estimatedSalePrice(propertyService.getClosePrice(propertyService.getCompProperty(propertySummary)), propertyService.getCompProperty(propertySummary).building?.size?.bldgSize) | number:'1.0-0'}}
                  <br>
                  Est. Sale Price
                  <br>
                  at {{propertyService.getCompProperty(propertySummary).building?.size?.bldgSize | number:'1.0-0'}} ft²
                </span>
              </div>
            </td>
            <td>{{roundDom(propertyService.getCompProperty(propertySummary).mls?.cdom)}}</td>
            <td>{{formatDate(propertyService.getCompProperty(propertySummary).mls?.closeDate || propertyService.getCompProperty(propertySummary).mls?.lastChangeDate)}}</td>
        </tr>
        <tr *ngIf="propertySummary" class="listing-summary" class="active">
          <td class="nopadding" colspan="16">
              <app-property-info
                  *ngIf="propertySummary"
                  [property]="propertyService.getCompProperty(propertySummary, 'hitMergedResponse', false)"
                  [subjectProperty]="propertyService.property"
                  hasClose="true"
                  (close)="togglePropertySummary(propertySummary)"
                  mode="comps">
              </app-property-info>
          </td>
        </tr>
        <template ngFor let-property [ngForOf]="propertyService.propertyCompsSelected">
          <tr class="selected" *ngIf="propertyService.getPropertyId(property) != propertySummary">
            <td class="picture">
              <div class="image"><img src="{{propertyService.getFirstPhoto(property)}}"></div>
            </td>
            <td class="left"><a class="clickable" (click)="togglePropertySummary(property)"><b>{{propertyService.getPropertyData(property).address?.line1}}<br>{{propertyService.getPropertyData(property).address?.line2}}</b></a></td>
            <td class="left" *ngIf="propertyService.propertyCompsMeta.hasRatings">
              <div class="calctooltip">
                {{ formatCompRating(property) }}
                <span class="calctooltiptext" style="font-size: 100%; width: 140px; text-align: right; padding-right: 10px" [innerHTML]="formatCompRatingStars(property.rating?.best)"></span>
              </div>
              <br> {{ formatCompRatingLabel(property) }}
            </td>
            <td>{{property.distance}}</td>
            <td>{{propertyService.getPropertyData(property, 'mls').building?.rooms?.beds}}</td>
            <td>{{propertyService.getPropertyData(property, 'mls').building?.rooms?.bathsFull}}/{{propertyService.getPropertyData(property, 'mls').building?.rooms?.bathsHalf}}</td>
            <td>{{propertyService.getPropertyData(property, 'mls').building?.parking?.prkgSpaces}}</td>
            <td>{{propertyService.getPropertyData(property, 'mls').summary?.yearBuilt}}</td>
            <td>{{(propertyService.getPropertyData(property, 'mls').lot?.poolInd && ('0' != propertyService.getPropertyData(property, 'mls').lot?.poolInd)) ? 'Y' : 'N'}}</td>
            <td>{{propertyService.getPropertyData(property, 'mls').building?.size?.livingSize || propertyService.getPropertyData(property, 'mls').building?.size?.bldgSize}}</td>
            <td>{{propertyService.getPropertyData(property, 'mls').lot?.lotSizeInAcres}}</td>
            <td>
              <div class="calctooltip">
                {{propertyService.getListPrice(property)}}
                <span class="calctooltiptext" style="width: 100px">Original: {{propertyService.getOriginalListPrice(property)}}</span>
              </div>
            </td>
            <!--<td>-</td>-->
            <!--<td>-</td>-->
            <td>
              <div class="calctooltip">
                ${{pricePerFootage(propertyService.getListPrice(property), propertyService.getPropertyData(property, 'mls').building?.size?.bldgSize) | number:'1.0-0'}}
                <span class="calctooltiptext" style="width: 100px">
                  ${{pricePerFootage(propertyService.getClosePrice(property), propertyService.getPropertyData(property, 'mls').building?.size?.bldgSize) | number:'1.0-0' }} / ft²
                  <br><br>
                  ${{estimatedSalePrice(propertyService.getClosePrice(property), propertyService.getPropertyData(property, 'mls').building?.size?.bldgSize) | number:'1.0-0'}}
                  <br>
                  Est. Sale Price
                  <br>
                  at {{propertyService.getPropertyData(property, 'mls').building?.size?.bldgSize | number:'1.0-0'}} ft²
                </span>
              </div>
            </td>
            <td>{{roundDom(propertyService.getPropertyData(property, 'mls').mls?.cdom)}}</td>
            <td>{{formatDate(propertyService.getPropertyData(property, 'mls').mls?.closeDate || propertyService.getPropertyData(property, 'mls').mls?.lastChangeDate)}}</td>
          </tr>
        </template>
        <!-- | paginate: { itemsPerPage: propertyService.size, currentPage: page, totalItems: propertyService.propertyCompsMeta.totalElements } -->
        <template ngFor let-property [ngForOf]="propertyService.propertyComps">
          <tr *ngIf="!propertyService.isCompSelected(property) && !isPropertySummaryOpen(property)">
            <td class="picture">
              <div class="image"><img src="{{propertyService.getFirstPhoto(property)}}"></div>
            </td>
            <td class="left"><a class="clickable" (click)="togglePropertySummary(property)"><b>{{propertyService.getPropertyData(property).address?.line1}}<br>{{propertyService.getPropertyData(property).address?.line2}}</b></a></td>
            <td class="left" *ngIf="propertyService.propertyCompsMeta.hasRatings">
              <div class="calctooltip">
                {{ formatCompRating(property) }}
                <span class="calctooltiptext" style="font-size: 100%; width: 140px; text-align: right; padding-right: 10px" [innerHTML]="formatCompRatingStars(property.rating?.best)"></span>
              </div>
              <br> {{ formatCompRatingLabel(property) }}
            </td>
            <td>{{property.distance}}</td>
            <td>{{propertyService.getPropertyData(property, 'mls').building.rooms.beds}}</td>
            <td>{{propertyService.getPropertyData(property, 'mls').building.rooms.bathsFull}}/{{propertyService.getPropertyData(property, 'mls').building.rooms.bathsHalf}}</td>
            <td>{{propertyService.getPropertyData(property, 'mls').building?.parking?.prkgSpaces}}</td>
            <td>{{propertyService.getPropertyData(property, 'mls').summary?.yearBuilt}}</td>
            <td>{{(propertyService.getPropertyData(property, 'mls').lot?.poolInd && ('0' != propertyService.getPropertyData(property, 'mls').lot.poolInd)) ? 'Y' : 'N'}}</td>
            <td>{{propertyService.getPropertyData(property, 'mls').building?.size?.livingSize || propertyService.getPropertyData(property, 'mls').building?.size?.bldgSize}}</td>
            <td>{{propertyService.getPropertyData(property, 'mls').lot?.lotSizeInAcres}}</td>
            <td>
              <div class="calctooltip">
                {{propertyService.getListPrice(property)}}
                <span class="calctooltiptext" style="width: 100px">Original: {{propertyService.getOriginalListPrice(property)}}</span>
              </div>
            </td>
            <!--<td>-</td>-->
            <!--<td>-</td>-->
            <td>
              <div class="calctooltip">
                ${{pricePerFootage(propertyService.getListPrice(property), propertyService.getPropertyData(property, 'mls').building?.size?.bldgSize) | number:'1.0-0'}}
                <span class="calctooltiptext" style="width: 100px">
                  ${{pricePerFootage(propertyService.getClosePrice(property), propertyService.getPropertyData(property, 'mls').building?.size?.bldgSize) | number:'1.0-0'}} / ft²
                  <br><br>
                  ${{estimatedSalePrice(propertyService.getClosePrice(property), propertyService.getPropertyData(property, 'mls').building?.size?.bldgSize) | number:'1.0-0'}}
                  <br>
                  Est. Sale Price
                  <br>
                  at {{propertyService.getPropertyData(property, 'mls').building?.size?.bldgSize | number:'1.0-0'}} ft²
                </span>
              </div>
            </td>
            <td>{{roundDom(propertyService.getPropertyData(property, 'mls').mls?.cdom)}}</td>
            <td>{{formatDate(propertyService.getPropertyData(property, 'mls').mls?.closeDate || propertyService.getPropertyData(property, 'mls').mls?.lastChangeDate)}}</td>
          </tr>
        </template>
      </tbody>
    </table>
    <table *ngIf="page < 1 && hasExcludedComps()">
      <thead>
        <tr>
          <th>&nbsp;</th>
          <th class="left">Excluded Comps</th>
          <th class="left" *ngIf="propertyService.propertyCompsMeta.hasRatings">Rating</th>
          <th>Dist</th>
          <th>Bed</th>
          <th>Bth</th>
          <th>GAR/TCP</th>
          <th>Year</th>
          <th>Pool</th>
          <th>SqFt</th>
          <th>Acres</th>
          <th>List</th>
          <!--<th>Sold Price</th>-->
          <!--<th>SP%LP</th>-->
          <th>$/Sqft</th>
          <th>CDOM</th>
          <th>Close Date</th>
        </tr>
      </thead>
      <tbody>
        <!-- | paginate: { itemsPerPage: propertyService.size, currentPage: page, totalItems: propertyService.propertyCompsMeta.totalElements } -->
        <template ngFor let-property [ngForOf]="propertyService.propertyCompsExcluded">
          <tr *ngIf="!propertyService.isCompSelected(property) && !isPropertySummaryOpen(property)">
            <td class="picture">
              <div class="image"><img src="{{propertyService.getFirstPhoto(property)}}"></div>
            </td>
            <td class="left"><a class="clickable">
              <b>{{propertyService.getPropertyData(property).address?.line1}}<br>{{propertyService.getPropertyData(property).address?.line2}}</b>
              <br>{{getExcludedReason(property)}}
            </a></td>
            <td class="left" *ngIf="propertyService.propertyCompsMeta.hasRatings">
              <div class="calctooltip">
                {{ formatCompRating(property) }}
                <span class="calctooltiptext" style="font-size: 100%; width: 140px; text-align: right; padding-right: 10px" [innerHTML]="formatCompRatingStars(property.rating?.best)"></span>
              </div>
              <br> {{ formatCompRatingLabel(property) }}
            </td>
            <td>{{property.distance}}</td>
            <td>{{propertyService.getPropertyData(property, 'mls').building.rooms.beds}}</td>
            <td>{{propertyService.getPropertyData(property, 'mls').building.rooms.bathsFull}}/{{propertyService.getPropertyData(property, 'mls').building.rooms.bathsHalf}}</td>
            <td>{{propertyService.getPropertyData(property, 'mls').building?.parking?.prkgSpaces}}</td>
            <td>{{propertyService.getPropertyData(property, 'mls').summary?.yearBuilt}}</td>
            <td>{{(propertyService.getPropertyData(property, 'mls').lot?.poolInd && ('0' != propertyService.getPropertyData(property, 'mls').lot.poolInd)) ? 'Y' : 'N'}}</td>
            <td>{{propertyService.getPropertyData(property, 'mls').building?.size?.livingSize || propertyService.getPropertyData(property, 'mls').building?.size?.bldgSize}}</td>
            <td>{{propertyService.getPropertyData(property, 'mls').lot?.lotSizeInAcres}}</td>
            <td>
              <div class="calctooltip">
                {{propertyService.getListPrice(property)}}
                <span class="calctooltiptext" style="width: 100px">Original: {{propertyService.getOriginalListPrice(property)}}</span>
              </div>
            </td>
            <!--<td>-</td>-->
            <!--<td>-</td>-->
            <td>
              <div class="calctooltip">
                ${{pricePerFootage(propertyService.getListPrice(property), propertyService.getPropertyData(property, 'mls').building?.size?.bldgSize) | number:'1.0-0'}}
                <span class="calctooltiptext" style="width: 100px">
                  ${{pricePerFootage(propertyService.getClosePrice(property), propertyService.getPropertyData(property, 'mls').building?.size?.bldgSize) | number:'1.0-0'}} / ft²
                  <br><br>
                  ${{estimatedSalePrice(propertyService.getClosePrice(property), propertyService.getPropertyData(property, 'mls').building?.size?.bldgSize) | number:'1.0-0'}}
                  <br>
                  Est. Sale Price
                  <br>
                  at {{propertyService.getPropertyData(property, 'mls').building?.size?.bldgSize | number:'1.0-0'}} ft²
                </span>
              </div>
            </td>
            <td>{{roundDom(propertyService.getPropertyData(property, 'mls').mls?.cdom)}}</td>
            <td>{{formatDate(propertyService.getPropertyData(property, 'mls').mls?.closeDate || propertyService.getPropertyData(property, 'mls').mls?.lastChangeDate)}}</td>
          </tr>
        </template>
      </tbody>
    </table>
  </div>
  <div class="widget notice full-width" *ngIf="!generatedValue && propertySummary && page < 1">
    <h2>
      <div class="calctooltip" *ngIf="type">
        {{getCompLabel()}} ${{propertyService.getPropertyCompPrice()}}
        <span class="calctooltiptext" style="padding: 10px; font-weight: normal; font-size: 60%">{{getCompTooltip()}}</span>
      </div>
      <br>
      <small>{{getCompType()}}</small>
      <br>
      <a class="clickable" style="font-weight: lighter; font-size: 70%" (click)="narrativeShowMore()" *ngIf="!narrShowMore">Show more..</a>
      <a class="clickable" style="font-weight: lighter; font-size: 70%" (click)="narrativeShowLess()" *ngIf="narrShowMore">Show less..</a>
    </h2>
    <div class="note" [ngClass]="{'narr-show-more': narrShowMore, 'narr-show-less': !narrShowMore}" [innerHTML]="propertyService.describeCompProperties()"></div>
  </div>
  <div class="widget notice full-width" *ngIf="generatedValue && propertySummary && page < 1">
    <h2>
      <div class="calctooltip" *ngIf="type">
        {{getCompLabel()}} ${{propertyService.getPropertyCompPrice()}}
        <span class="calctooltiptext" style="padding: 10px; font-weight: normal; font-size: 60%">{{getCompTooltip()}}</span>
      </div>
    </h2>
    <div class="note" [ngClass]="{'narr-show-more': narrShowMore, 'narr-show-less': !narrShowMore}" [innerHTML]="propertyService.describeCompProperties()"></div>
  </div>
  <div class="widget table narrow full-width" *ngIf="page == 1 && columnProperties">
    <table>
      <thead>
        <tr>
          <th>&nbsp;</th>
          <th>
            Subject
            <a class="clickable" (click)="columnPrevPage()" *ngIf="columnCount > 3 && columnStart > 0">&lt;</a>
            <a class="clickable" (click)="columnNextPage()" *ngIf="columnCount > 3 && columnStart < columnCount - 3">&gt;</a>
          </th>
          <th colspan="2" *ngFor="let property of columnPage; let i = index">Sold {{i + 1}}</th>
        </tr>
      </thead>
      <tbody>
        <tr style="height: 120px">
          <td>&nbsp;</td>
          <td class="picture initial-width"><div class="image"><img src="{{propertyService.getFirstPhoto(propertyService.getCurrentProperty())}}"></div></td>
          <td class="picture initial-width" colspan="2" *ngFor="let property of columnPage"><div class="image"><img src="{{propertyService.getFirstPhoto(property)}}"></div></td>
        </tr>
        <tr>
          <td>Address</td>
          <td>{{propertyService.getCurrentProperty().address?.line1}}<br>{{propertyService.getCurrentProperty().address?.line2}}</td>
          <td colspan="2" *ngFor="let property of columnPage">{{propertyService.getPropertyData(property).address?.line1}}<br>{{propertyService.getPropertyData(property).address?.line2}}</td>
        </tr>
        <tr>
          <td>Proximity to subject</td>
          <td>&nbsp;</td>
          <td colspan="2" *ngFor="let property of columnPage">{{property.distance}}</td>
        </tr>
        <tr>
          <td>List price</td>
          <td>{{propertyService.getListPrice(propertyService.getCurrentProperty())}}</td>
          <td colspan="2" *ngFor="let property of columnPage">{{propertyService.getListPrice(property)}}</td>
        </tr>
        <tr>
          <td>Price per GLA</td>
          <td>${{pricePerFootage(propertyService.getListPrice(propertyService.getCurrentProperty()), propertyService.getCurrentProperty('mls').building?.size?.bldgSize) | number:'1.0-0'}}</td>
          <td colspan="2" *ngFor="let property of columnPage">
            <div class="calctooltip">
              ${{pricePerFootage(propertyService.getListPrice(property), propertyService.getPropertyData(property, 'mls').building?.size?.bldgSize) | number:'1.0-0'}}
              <span class="calctooltiptext" style="width: 100px">
                ${{pricePerFootage(propertyService.getClosePrice(property), propertyService.getPropertyData(property, 'mls').building?.size?.bldgSize) | number:'1.0-0'}} / ft²
                <br><br>
                ${{estimatedSalePrice(propertyService.getClosePrice(property), propertyService.getPropertyData(property, 'mls').building?.size?.bldgSize) | number:'1.0-0'}}
                <br>
                Est. Sale Price
                <br>
                at {{propertyService.getPropertyData(property, 'mls').building?.size?.bldgSize | number:'1.0-0'}} ft²
              </span>
            </div>
          </td>
        </tr>
        <tr>
          <td>Class</td>
          <td>{{propertyService.getQualityName(propertyService.getFlipSelectedQuality())}}</td>
          <td colspan="2" *ngFor="let property of columnPage">{{propertyService.getQualityName(propertyService.getFlipDefaultQuality())}}</td>
        </tr>
        <tr>
          <td>Year Built</td>
          <td>{{propertyService.getCurrentProperty('mls').summary?.yearBuilt}}</td>
          <td colspan="2" *ngFor="let property of columnPage">{{propertyService.getPropertyData(property, 'mls').summary?.yearBuilt}}</td>
        </tr>
        <!--tr>
          <td>Condition</td>
          <td>&nbsp;</td>
          <td colspan="2" *ngFor="let property of columnPage">&nbsp;</td>
        </tr-->
        <tr>
          <td>Above Grade Room Count</td>
          <td style="padding: 0">
            <div class="widget table narrow full-width" style="margin-bottom: -1px">
              <table>
                <tbody>
                  <tr>
                    <td>Rooms</td>
                    <td>Beds</td>
                    <td>Baths</td>
                  </tr>
                  <tr>
                    <td>{{inferTotalRooms(propertyService.getCurrentProperty('mls').building?.rooms)}}</td>
                    <td>{{propertyService.getCurrentProperty('mls').building?.rooms?.beds}}</td>
                    <td>
                      {{propertyService.getCurrentProperty('mls').building?.rooms?.bathsFull}}
                      <div *ngIf="propertyService.getCurrentProperty('mls').building?.rooms?.bathsHalf > 0">
                        {{propertyService.getCurrentProperty('mls').building?.rooms?.bathsHalf}}/2
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </td>
          <template ngFor let-property [ngForOf]="columnPage">
            <td style="padding: 0px" colspan="2">
              <div class="widget table narrow full-width" style="margin-bottom: -1px">
                <table>
                  <tbody>
                    <tr>
                      <td>Rm</td>
                      <td>Bd</td>
                      <td>Ba</td>
                    </tr>
                    <tr>
                      <td>{{inferTotalRooms(propertyService.getPropertyData(property, 'mls').building?.rooms)}}</td>
                      <td>{{propertyService.getPropertyData(property, 'mls').building?.rooms?.beds}}</td>
                      <td>
                        {{propertyService.getPropertyData(property, 'mls').building?.rooms?.bathsFull}}
                        <div *ngIf="propertyService.getCurrentProperty('mls').building?.rooms?.bathsHalf > 0">
                          {{propertyService.getPropertyData(property, 'mls').building?.rooms?.bathsHalf}}/2
                        </div>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </td>
            <!--td *ngIf="columnAdjustments"><br><br>${{(property.adjustment?.bathsFull?.adjustmentValue
                  + property.adjustment?.bathsHalf?.adjustmentValue
                  + property.adjustment?.bedrooms?.adjustmentValue) | number:'1.0-0'}}</td>
            <td *ngIf="!columnAdjustments"></td-->
          </template>
        </tr>
        <tr>
          <td>Gross Living Area</td>
          <td>{{propertyService.getCurrentProperty('mls').building?.size?.livingSize || propertyService.getCurrentProperty('mls').building?.size?.bldgSize}}</td>
          <template ngFor let-property [ngForOf]="columnPage">
            <td colspan="2">{{propertyService.getPropertyData(property, 'mls').building?.size?.livingSize || propertyService.getPropertyData(property, 'mls').building?.size?.bldgSize}}</td>
            <!--td *ngIf="columnAdjustments">${{property.adjustment?.footage?.adjustmentValue | number:'1.0-0'}}</td>
            <td *ngIf="!columnAdjustments"></td-->
          </template>
        </tr>
        <!--tr>
          <td>Garages</td>
          <td>{{propertyService.getCurrentProperty('mls').building?.parking?.prkgSpaces}}</td>
          <template ngFor let-property [ngForOf]="columnPage">
            <td>{{propertyService.getPropertyData(property, 'mls').building?.parking?.prkgSpaces}}</td>
            <td *ngIf="columnAdjustments">${{(property.adjustment?.garages?.adjustmentValue + property.adjustment?.carports?.adjustmentValue) | number:'1.0-0'}}</td>
            <td *ngIf="!columnAdjustments"></td>
          </template>
        </tr-->
        <tr *ngFor="let adjustmentCategory of columnAdjustments ? adjustmentCategories : []">
          <td>Adjustment: {{adjustmentCatNames[adjustmentCategory]}}</td>
          <td>&nbsp;</td>
          <template ngFor let-property [ngForOf]="columnPage">
            <td>&nbsp;</td>
            <td>${{property.adjustment?.indexedAdjustments[adjustmentCategory] | number:'1.0-0'}}</td>
          </template>
        </tr>
        <tr *ngIf="columnAdjustments">
          <td>Net Adjustment</td>
          <td>&nbsp;</td>
          <template ngFor let-property [ngForOf]="columnPage">
            <td>&nbsp;</td>
            <td>${{property.adjustment?.netAdjustment | number:'1.0-0'}}</td>
          </template>
        </tr>
        <tr *ngIf="columnAdjustments">
          <td>Adjusted Value</td>
          <td>&nbsp;</td>
          <template ngFor let-property [ngForOf]="columnPage">
            <td>&nbsp;</td>
            <td>${{property.adjustment?.postAdjustment | number:'1.0-0'}}</td>
          </template>
        </tr>
      </tbody>
    </table>
  </div>
</div>
